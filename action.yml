name: Logseq Excalidraw to SVG
description: Converts excalidraw to svg references
inputs:
  dark-mode:
    description: If drawings should be exported in dark mode
    required: false
    default: 'false'
runs:
  using: composite
  steps:
    - name: Start containers
      run: docker-compose -f "${{ github.action_path }}/docker-compose.yml" up -d --build
      shell: bash
    - run: bash "${{ github.action_path }}/wait_for_kroki.sh"
      shell: bash
    - name: Creating SVG files
      run: (cd "${{ github.workspace }}" && find . -type f -name '*.excalidraw' -exec bash "${{ github.action_path }}/to_svg.sh" "{}" ${{ inputs.dark-mode == 'true' }} ";")
      shell: bash
    - name: Replace excalidraw file references
      run: find "${{ github.workspace }}" -type f -name '*.md' -exec sed -ri 's|\[\[(.*\.excalidraw)\]\]|![\1](assets/autogen/\1.svg)|g' "{}" ";"
      shell: bash
    - name: Debug - Setup tmate session
      uses: mxschmitt/action-tmate@v3
    - name: Stop containers
      run: docker-compose -f "${{ github.action_path }}/docker-compose.yml" down
      shell: bash

